{% extends "base.html" %}

{% block content %}

<section class="tree-section">
  <div class="tree-box">

    <h1 class="gradient-text"><i class="fa-solid fa-book"></i> Dictionary Search</h1>

    {% if message %}
      <div class="tree-message">{{ message }}</div>
    {% endif %}

    <!-- forms moved into .tree-controls so preview appears to the right -->

    <div class="tree-content">
      <div class="tree-controls">
        <!-- Add Word -->
        <form method="POST" action="/dict_search" class="tree-form">
          <h3>Add Word</h3>
          <div class="form-group">
            <label for="word_add">Word:</label>
            <input type="text" name="word" id="word_add" placeholder="Enter word..." required>
            <input type="hidden" name="action" value="add">
          </div>
          <button type="submit" class="btn-primary">Add</button>
        </form>

        <!-- Search Word -->
        <form method="POST" action="/dict_search" class="tree-form">
          <h3>Search Word</h3>
          <div class="form-group">
            <label for="word_search">Word:</label>
            <input type="text" name="word" id="word_search" placeholder="Word to search..." required>
            <input type="hidden" name="action" value="search">
          </div>
          <button type="submit" class="btn-primary-tree">Search</button>
        </form>

        <!-- Delete Word -->
        <form method="POST" action="/dict_search" class="tree-form">
          <h3>Delete Word</h3>
          <div class="form-group">
            <label for="word_delete">Word:</label>
            <input type="text" name="word" id="word_delete" placeholder="Word to delete..." required>
            <input type="hidden" name="action" value="delete">
          </div>
          <button type="submit" class="btn-primary-tree">Delete</button>
        </form>

        <!-- Show All Words -->
        <form method="POST" action="/dict_search" class="tree-form">
          <h3>Show All Words</h3>
          <input type="hidden" name="action" value="all">
          <button type="submit" class="btn-primary-tree">View Words</button>
        </form>

        <!-- Delete all -->
        <form method="POST" action="/dict_search" class="tree-form">
          <h3>Delete All Nodes</h3>
          <input type="hidden" name="action" value="delete_all">
          <button type="submit" class="btn-primary-tree">Delete All</button>
        </form>

        {% macro serialize(node) -%}
        {%- if node -%}
        {"value": {{ node.value|tojson }}, "left": {{ serialize(node.left) }}, "right": {{ serialize(node.right) }} }
        {%- else -%}
        null
        {%- endif -%}
        {%- endmacro %}

        <!-- Visual Tree (BST) will be on the right preview column -->
      </div>

      <div class="tree-preview">
        <div class="tree-display">
          <h2>Dictionary Search Visualization:</h2>
          <div id="tree-visualizer" class="tree-visualizer-container"></div>
        </div>
      </div>
    </div>

    <!-- Search Result -->
    {% if result %}
      <div class="tree-display">
        <h2>Result</h2>

        {% if result.found is defined %}
          <p><strong>Found:</strong> {{ result.found }}</p>
        {% endif %}

        {% if result.path %}
          <p><strong>Search Path:</strong> {{ result.path | join(' â†’ ') }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% if words %}
    <div class="dictionary-list-box">
      <h2>DICTIONARY:</h2>
      <ul class="flat-list">
        {% for w in words %}
          <li>{{ w }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    {# message already shown near the top; no duplicate display here #}

  </div>
</section>

<script src="{{ url_for('static', filename='js/tree-visualizer.js') }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var treeData = {{ serialize(tree)|safe }};
    var searchPath = {{ (result.path|tojson) if result is defined and result.path is defined else 'null' }};
    initTreeVisualizer('tree-visualizer', treeData, searchPath);
  });
</script>

{% endblock %}
