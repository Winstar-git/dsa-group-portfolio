{% extends 'base.html' %}

{% block content %}
<section class="sorting-section">
  <div class="container">
    <header class="sorting-header">
      <h1 class="gradient-text">Sorting Algorithm Visualizer</h1>
      <p class="subtitle">Understand how sorting algorithms work step by step</p>
    </header>

    <div class="sorting-container">
      <div class="sorting-controls">
        <h2 class="control-title">Setup</h2>
        <form method="POST" class="sorting-form">
          <div class="form-group">
            <label for="algorithm">Select Algorithm:</label>
            <select id="algorithm" name="algorithm" class="form-select">
              <option value="bubble" {% if result and result.algorithm == 'Bubble Sort' %}selected{% endif %}>Bubble Sort</option>
              <option value="selection" {% if result and result.algorithm == 'Selection Sort' %}selected{% endif %}>Selection Sort</option>
              <option value="insertion" {% if result and result.algorithm == 'Insertion Sort' %}selected{% endif %}>Insertion Sort</option>
              <option value="merge" {% if result and result.algorithm == 'Merge Sort' %}selected{% endif %}>Merge Sort</option>
              <option value="quick" {% if result and result.algorithm == 'Quick Sort' %}selected{% endif %}>Quick Sort</option>
            </select>
          </div>

          <div class="form-group">
            <label for="size">Array Size (5-50):</label>
            <input 
              type="number" 
              id="size" 
              name="size" 
              min="5" 
              max="50" 
              value="{{ request.form.get('size', '10') }}" 
              class="form-input"
            >
          </div>

          <button type="submit" class="btn-run">
            <i class="fas fa-play"></i> Generate & Run
          </button>
        </form>
      </div>

      <div class="sorting-results">
        {% if result %}
          {% if result.error %}
            <div class="error-message">
              <strong>Error:</strong> {{ result.error }}
            </div>
          {% else %}
            <div class="algo-card">
              <div class="algo-header">
                <h2 class="algo-title gradient-text">{{ result.algorithm }}</h2>
              </div>
              
              <div class="algo-info">
                <div class="info-item">
                  <span class="label">Original Array:</span>
                  <span class="value">[{{ result.original|join(', ') }}]</span>
                </div>
                <div class="info-item">
                  <span class="label">Sorted Array:</span>
                  <span class="value">[{{ result.sorted|join(', ') }}]</span>
                </div>
              </div>

              <div class="metrics">
                <div class="metric">
                  <span class="metric-label">Comparisons:</span>
                  <span class="metric-value">{{ result.comparisons }}</span>
                </div>
                <div class="metric">
                  <span class="metric-label">Swaps/Shifts:</span>
                  <span class="metric-value">
                    {% if result.swaps > 0 %}
                      {{ result.swaps }} swaps
                    {% elif result.shifts > 0 %}
                      {{ result.shifts }} shifts
                    {% else %}
                      0
                    {% endif %}
                  </span>
                </div>
                <div class="metric">
                  <span class="metric-label">Total Steps:</span>
                  <span class="metric-value">{{ result.total_steps }}</span>
                </div>
              </div>

              <div class="visualization-box">
                <div id="bar-container" class="bar-container">
                  </div>
                
                <div class="viz-controls">
                  <div class="control-group">
                    <button id="play-pause-btn" type="button" class="btn-viz"><i class="fas fa-play"></i> Play</button>
                    <button id="reset-btn" type="button" class="btn-viz"><i class="fas fa-undo"></i> Reset</button>
                  </div>
                  
                  <div class="speed-control">
                    <label for="speed">Speed</label>
                    <input type="range" id="speed" min="10" max="550" value="450">
                  </div>
                  
                  <span id="step-counter" class="step-counter">Step: 0 / {{ result.total_steps }}</span>
                </div>
              </div>

              <div class="steps-container">
                <h3 class="steps-title">Step-by-Step Execution</h3>
                <pre class="steps-output">
Original Array: [{{ result.original|join(', ') }}]

{% for step in result.steps %}{{ step }}
{% endfor %}

Sorted Array: [{{ result.sorted|join(', ') }}]
                </pre>
              </div>
            </div>

            <script>
                const sortingData = {{ result | tojson | safe }};
            </script>
            <script src="{{ url_for('static', filename='js/visualizer.js') }}"></script>

          {% endif %}
        {% else %}
          <div class="placeholder">
            <div class="placeholder-content">
              <i class="fas fa-sort"></i>
              <p>Select an algorithm and click "Generate & Run" to see the step-by-step sorting process</p>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
{% endblock %}